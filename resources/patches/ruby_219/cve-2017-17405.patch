From 0207c68ea39b74fc99e445231c1ac08ad5406720 Mon Sep 17 00:00:00 2001
From: usa <usa@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date: Thu, 14 Dec 2017 13:53:48 +0000
Subject: [PATCH 1/2] merge revision(s) 61242: [Backport #14185]

	Fix a command injection vulnerability in Net::FTP.

  This file patches `lib/net/ftp.rb` only; ChangeLog, version, and test
  changes were left out because some didn't apply cleanly. Also left out
  is the second commit of this two-part fix - it consisted only of test
  changes.

git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_2@61246 b2dd03c8-39d4-4d8f-98ff-823fe69b080e
---
 ChangeLog                |   4 +
 lib/net/ftp.rb           |  10 +-
 test/net/ftp/test_ftp.rb | 234 +++++++++++++++++++++++++++++++++++++++++++++++
 version.h                |   2 +-
 4 files changed, 244 insertions(+), 6 deletions(-)

diff --git a/lib/net/ftp.rb b/lib/net/ftp.rb
index c9b80c6804..79edb80864 100644
--- a/lib/net/ftp.rb
+++ b/lib/net/ftp.rb
@@ -606,10 +606,10 @@ module Net
       if localfile
         if @resume
           rest_offset = File.size?(localfile)
-          f = open(localfile, "a")
+          f = File.open(localfile, "a")
         else
           rest_offset = nil
-          f = open(localfile, "w")
+          f = File.open(localfile, "w")
         end
       elsif !block_given?
         result = ""
@@ -637,7 +637,7 @@ module Net
     def gettextfile(remotefile, localfile = File.basename(remotefile)) # :yield: line
       result = nil
       if localfile
-        f = open(localfile, "w")
+        f = File.open(localfile, "w")
       elsif !block_given?
         result = ""
       end
@@ -683,7 +683,7 @@ module Net
       else
         rest_offset = nil
       end
-      f = open(localfile)
+      f = File.open(localfile)
       begin
         f.binmode
         if rest_offset
@@ -702,7 +702,7 @@ module Net
     # passing in the transmitted data one line at a time.
     #
     def puttextfile(localfile, remotefile = File.basename(localfile), &block) # :yield: line
-      f = open(localfile)
+      f = File.open(localfile)
       begin
         storlines("STOR " + remotefile, f, &block)
       ensure
